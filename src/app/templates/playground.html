{% extends 'base.html' %}

{% block title %}Centro de Operaciones Logísticas{% endblock %}

{% block extra_head %}
<style>
  /* Estilos generales con soporte para tema claro/oscuro */
  .title-container {
    text-align: center;
    margin-bottom: 40px;
    position: relative;
  }
  .main-title {
    font-size: 2.5em;
    font-weight: bold;
    margin-bottom: 5px;
    color: #2c3e50;
    text-transform: uppercase;
    letter-spacing: 1px;
  }
  .dark .main-title {
    color: #ecf0f1;
  }
  .subtitle {
    font-size: 1.2em;
    color: #7f8c8d;
    font-weight: 300;
    margin-top: 5px;
  }
  .dark .subtitle {
    color: #a0aec0;
  }
  .title-icon {
    display: inline-block;
    margin: 0 15px;
    color: #3498db;
    vertical-align: middle;
  }
  .dark .title-icon {
    color: #60a5fa;
  }
  .title-divider {
    width: 100px;
    height: 4px;
    background: linear-gradient(90deg, #3498db, #2ecc71);
    margin: 15px auto;
    border-radius: 2px;
  }
  .dark .title-divider {
    background: linear-gradient(90deg, #60a5fa, #059669);
  }
  h1 {
    text-align: center;
    font-size: 2.2em;
    margin-bottom: 30px;
    color: #2c3e50;
  }
  .dark h1 {
    color: #ecf0f1;
  }
  .container {
    display: flex;
    flex-direction: column;
    gap: 25px;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
  }
  .row {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
  }
  /* Estilos para cada tarjeta (card) */
  .card {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    padding: 16px;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .dark .card {
    background: #1e293b;
    box-shadow: 0 5px 15px rgba(0,0,0,0.2);
  }
  .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  }
  .dark .card:hover {
    box-shadow: 0 8px 20px rgba(0,0,0,0.3);
  }
  .card-vertical {
    flex: 1;
    min-width: 250px;
    max-width: 300px;
  }
  .card-horizontal {
    width: 100%;
  }
  .card h2 {
    font-size: 1.3em;
    margin-top: 0;
    margin-bottom: 15px;
    text-align: center;
    color: #2c3e50;
    padding-bottom: 10px;
    border-bottom: 1px solid #eaeaea;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .dark .card h2 {
    color: #ecf0f1;
    border-bottom: 1px solid #4b5563;
  }
  .card h2 i {
    margin-right: 8px;
    color: #3498db;
  }
  .dark .card h2 i {
    color: #60a5fa;
  }
  .log {
    list-style: none;
    padding: 0;
    max-height: 300px;
    overflow-y: auto;
    margin-top: 10px;
    border-radius: 4px;
    background-color: #f9f9f9;
  }
  .dark .log {
    background-color: #374151;
  }
  .log li {
    padding: 10px 12px;
    border-bottom: 1px solid #eee;
    font-size: 0.9em;
    position: relative;
    transition: background-color 0.2s;
  }
  .dark .log li {
    border-bottom: 1px solid #4b5563;
  }
  .log li:hover {
    background-color: #f0f0f0;
  }
  .dark .log li:hover {
    background-color: #4b5563;
  }
  .log li:last-child {
    border-bottom: none;
  }
  .timestamp {
    font-weight: bold;
    color: #7f8c8d;
    margin-right: 6px;
  }
  .dark .timestamp {
    color: #d1d5db;
  }
  /* Estilos para la sección de contratación */
  .carga-item {
    padding: 15px;
    margin: 8px 0;
    border: 1px solid #eee;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    background-color: #fff;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .dark .carga-item {
    background-color: #1e293b;
    border: 1px solid #4b5563;
  }
  .carga-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  .dark .carga-item:hover {
    box-shadow: 0 4px 8px rgba(0,0,0,0.3);
  }
  .carga-header {
    font-weight: bold;
    font-size: 1.1em;
    margin-bottom: 10px;
    color: #2c3e50;
    display: flex;
    align-items: center;
  }
  .dark .carga-header {
    color: #e5e7eb;
  }
  .carga-header i {
    margin-right: 8px;
    color: #3498db;
  }
  .dark .carga-header i {
    color: #60a5fa;
  }
  .carga-details {
    display: flex;
    margin: 8px 0 15px;
    color: #555;
    font-size: 0.9em;
  }
  .dark .carga-details {
    color: #d1d5db;
  }
  .carga-detail {
    display: flex;
    align-items: center;
    margin-right: 18px;
  }
  .carga-detail i {
    margin-right: 5px;
    color: #7f8c8d;
  }
  .dark .carga-detail i {
    color: #9ca3af;
  }
  .carga-acciones {
    display: flex;
    gap: 10px;
    margin-top: 5px;
    align-self: flex-end;
  }
  .btn {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9em;
    display: flex;
    align-items: center;
    transition: transform 0.1s, opacity 0.1s, background-color 0.2s;
  }
  .btn i {
    margin-right: 5px;
  }
  .btn:hover {
    transform: translateY(-2px);
  }
  .btn:active {
    transform: translateY(1px);
  }
  .btn-aceptar {
    background-color: #2ecc71;
    color: white;
  }
  .btn-aceptar:hover {
    background-color: #27ae60;
  }
  .dark .btn-aceptar {
    background-color: #059669;
  }
  .dark .btn-aceptar:hover {
    background-color: #047857;
  }
  .btn-rechazar {
    background-color: #e74c3c;
    color: white;
  }
  .btn-rechazar:hover {
    background-color: #c0392b;
  }
  .dark .btn-rechazar {
    background-color: #dc2626;
  }
  .dark .btn-rechazar:hover {
    background-color: #b91c1c;
  }
  .btn-confirmar {
    background-color: #3498db;
    color: white;
  }
  .btn-confirmar:hover {
    background-color: #2980b9;
  }
  .dark .btn-confirmar {
    background-color: #3b82f6;
  }
  .dark .btn-confirmar:hover {
    background-color: #2563eb;
  }
  .mensaje-confirmacion {
    margin-top: 10px;
    padding: 8px;
    border-radius: 4px;
    font-size: 0.9em;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .confirmacion-aceptar {
    background-color: #e8f5e9;
    color: #2e7d32;
  }
  .dark .confirmacion-aceptar {
    background-color: #064e3b;
    color: #d1fae5;
  }
  .confirmacion-rechazar {
    background-color: #ffebee;
    color: #c62828;
  }
  .dark .confirmacion-rechazar {
    background-color: #7f1d1d;
    color: #fee2e2;
  }
  /* Estilo específico para grid de cargas */
  .cargas-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 15px;
    margin-top: 15px;
  }

  /* Scrollbar personalizada para modo claro/oscuro */
  .log::-webkit-scrollbar {
    width: 8px;
  }
  .log::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 4px;
  }
  .dark .log::-webkit-scrollbar-track {
    background: #4b5563;
  }
  .log::-webkit-scrollbar-thumb {
    background: #c1c1c1;
    border-radius: 4px;
  }
  .dark .log::-webkit-scrollbar-thumb {
    background: #6b7280;
  }
  .log::-webkit-scrollbar-thumb:hover {
    background: #a0a0a0;
  }
  .dark .log::-webkit-scrollbar-thumb:hover {
    background: #9ca3af;
  }

  /* Estilos para la sección de servicios aceptados */
  .servicios-aceptados, .servicios-confirmados {
    padding: 15px;
    background-color: #fff;
    border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .dark .servicios-aceptados, .dark .servicios-confirmados {
    background-color: #1e293b;
    box-shadow: 0 2px 4px rgba(0,0,0,0.2);
  }
  .servicios-aceptados h2, .servicios-confirmados h2 {
    border-bottom: 1px solid #eaeaea;
    padding-bottom: 10px;
    margin-bottom: 15px;
    text-align: center;
  }
  .dark .servicios-aceptados h2, .dark .servicios-confirmados h2 {
    border-bottom: 1px solid #4b5563;
  }
  .servicio-aceptado-item {
    display: flex;
    align-items: center;
    padding: 12px 16px;
    margin-bottom: 10px;
    border-radius: 8px;
    background-color: rgba(46, 204, 113, 0.1);
    border-left: 4px solid #2ecc71;
    transition: transform 0.2s;
  }
  .dark .servicio-aceptado-item {
    background-color: rgba(16, 185, 129, 0.1);
    border-left: 4px solid #059669;
  }
  .servicio-aceptado-item:hover {
    transform: translateY(-2px);
  }
  .servicio-aceptado-info {
    flex: 1;
  }
  .servicio-aceptado-header {
    font-weight: bold;
    font-size: 1.05em;
    margin-bottom: 4px;
    color: #2c3e50;
  }
  .dark .servicio-aceptado-header {
    color: #ecf0f1;
  }
  .servicio-aceptado-header i {
    margin-right: 8px;
    color: #2ecc71;
  }
  .dark .servicio-aceptado-header i {
    color: #059669;
  }
  .servicio-aceptado-details {
    display: flex;
    font-size: 0.85em;
    color: #7f8c8d;
  }
  .dark .servicio-aceptado-details {
    color: #9ca3af;
  }
  .servicio-aceptado-detail {
    display: flex;
    align-items: center;
    margin-right: 16px;
  }
  .servicio-aceptado-detail i {
    margin-right: 4px;
  }
  .servicio-aceptado-fecha {
    font-size: 0.85em;
    color: #7f8c8d;
    display: flex;
    align-items: center;
  }
  .dark .servicio-aceptado-fecha {
    color: #9ca3af;
  }
</style>
{% endblock %}

{% block content %}
<div class="title-container mt-8">
  <div class="main-title">
    <i class="fas fa-ship title-icon"></i>
    Centro de Operaciones Logísticas
    <i class="fas fa-truck title-icon"></i>
  </div>
  <div class="subtitle">Visualización y gestión de operaciones en tiempo real</div>
  <div class="title-divider"></div>
</div>

<div class="container pb-10">
  <div class="row">
    <div class="card card-vertical" id="importadores">
      <h2><i class="fas fa-ship"></i> Importadores</h2>
      <ul class="log" id="log-importadores"></ul>
    </div>
    <div class="card card-vertical" id="seguros">
      <h2><i class="fas fa-shield-alt"></i> Seguros</h2>
      <ul class="log" id="log-seguros"></ul>
    </div>
    <div class="card card-vertical" id="transportistas">
      <h2><i class="fas fa-truck"></i> Transportistas</h2>
      <ul class="log" id="log-transportistas"></ul>
    </div>
    <div class="card card-vertical" id="despachantes">
      <h2><i class="fas fa-clipboard-check"></i> Despachantes de Aduana</h2>
      <ul class="log" id="log-despachantes"></ul>
    </div>
  </div>
  
  <div class="card card-horizontal" id="contratacion">
    <h2><i class="fas fa-handshake"></i> Contratación de Servicios</h2>
    <div id="cargas-disponibles" class="cargas-grid">
      <!-- Las cargas disponibles se cargarán aquí dinámicamente -->
    </div>
  </div>
  
  <!-- Sección para servicios aceptados y confirmados en dos cards side by side -->
  <div class="card card-horizontal" id="servicios-container" style="display: none; margin-top: 20px;">
    <div class="row" style="width: 100%; margin: 0; gap: 15px;">
      <div class="servicios-aceptados" id="servicios-aceptados" style="flex: 1; min-width: 0;">
        <h2><i class="fas fa-check-circle"></i> Servicios Aceptados</h2>
        <div id="lista-servicios-aceptados">
          <!-- Los servicios aceptados se mostrarán aquí -->
        </div>
      </div>
      
      <div class="servicios-confirmados" id="servicios-confirmados" style="flex: 1; min-width: 0;">
        <h2><i class="fas fa-clipboard-check"></i> Servicios Confirmados</h2>
        <div id="lista-servicios-confirmados">
          <!-- Los servicios confirmados se mostrarán aquí -->
        </div>
      </div>
    </div>
  </div>
</div>

<script>
  // Detector de cambio de tema para actualizar dinámicamente elementos creados
  const observer = new MutationObserver((mutations) => {
    const isDarkMode = document.documentElement.classList.contains('dark');
    document.querySelectorAll('.carga-item, .servicio-aceptado-item').forEach(item => {
      if (isDarkMode) {
        item.classList.add('dark-mode');
      } else {
        item.classList.remove('dark-mode');
      }
    });
  });
  
  observer.observe(document.documentElement, { 
    attributes: true, 
    attributeFilter: ['class'] 
  });

  // Datos de cada rol con mensajes de ejemplo
  const roles = [
    {
      id: 'importadores',
      log: 'log-importadores',
      mensajes: ['Pedido recibido', 'Documentación enviada', 'Aprobación de importación'],
      icon: 'ship'
    },
    {
      id: 'seguros',
      log: 'log-seguros',
      mensajes: ['Póliza emitida', 'Revisión de cobertura', 'Pago confirmado'],
      icon: 'shield-alt'
    },
    {
      id: 'transportistas',
      log: 'log-transportistas',
      mensajes: ['Vehículo asignado', 'Salida en ruta', 'Llegada estimada'],
      icon: 'truck'
    },
    {
      id: 'despachantes',
      log: 'log-despachantes',
      mensajes: ['Despacho en proceso', 'Documentos verificados', 'Despacho completado'],
      icon: 'clipboard-check'
    }
  ];

  // Función para agregar un mensaje a la lista correspondiente
  function agregarMensaje(roleObj) {
    const logUl = document.getElementById(roleObj.log);
    const li = document.createElement('li');
    // Selecciona un mensaje aleatorio del arreglo
    const msg = roleObj.mensajes[Math.floor(Math.random() * roleObj.mensajes.length)];
    // Se agrega una marca de tiempo para simular un log en tiempo real
    const timestamp = new Date().toLocaleTimeString();
    li.innerHTML = `<span class="timestamp">[${timestamp}]</span> <i class="fas fa-${roleObj.icon}"></i> ${msg}`;
    logUl.appendChild(li);
    // Se asegura de que la vista haga scroll hacia el final para ver el mensaje nuevo
    logUl.scrollTop = logUl.scrollHeight;
  }

  // Simula la llegada de mensajes en intervalos aleatorios (entre 2 y 5 segundos)
  roles.forEach(role => {
    setInterval(() => {
      agregarMensaje(role);
    }, Math.random() * 3000 + 2000);
  });

  // Datos de cargas disponibles (simulados)
  const cargasDisponibles = [
    { 
      id: 1, 
      descripcion: 'Contenedor de electrónicos desde China', 
      peso: '2500kg', 
      fecha: '15/06/2023',
      icon: 'microchip'
    },
    { 
      id: 2, 
      descripcion: 'Carga de alimentos refrigerados', 
      peso: '1800kg', 
      fecha: '18/06/2023',
      icon: 'temperature-low' 
    },
    { 
      id: 3, 
      descripcion: 'Materiales de construcción', 
      peso: '4200kg', 
      fecha: '20/06/2023',
      icon: 'hard-hat'
    },
    { 
      id: 4, 
      descripcion: 'Productos farmacéuticos', 
      peso: '950kg', 
      fecha: '22/06/2023',
      icon: 'pills'
    },
    { 
      id: 5, 
      descripcion: 'Equipamiento industrial', 
      peso: '3100kg', 
      fecha: '25/06/2023',
      icon: 'industry'
    }
  ];

  // Array para almacenar los servicios aceptados
  const serviciosAceptados = [];

  // Array para almacenar los servicios confirmados
  const serviciosConfirmados = [];

  // Mapa de iconos para diferentes tipos de cargas
  const iconMap = {
    'textiles': 'tshirt',
    'médicos': 'heartbeat',
    'automotrices': 'car',
    'químicos': 'flask',
    'oficina': 'chair',
    'electrónicos': 'laptop'
  };

  // Función para generar una nueva carga disponible de forma aleatoria
  function generarNuevaCarga() {
    const cargasDef = [
      { desc: 'Contenedor de productos textiles', icon: 'tshirt' }, 
      { desc: 'Equipos médicos urgentes', icon: 'heartbeat' }, 
      { desc: 'Materiales automotrices', icon: 'car' }, 
      { desc: 'Productos químicos industriales', icon: 'flask' },
      { desc: 'Mobiliario de oficina', icon: 'chair' },
      { desc: 'Equipos electrónicos sensibles', icon: 'laptop' }
    ];
    
    const cargaSeleccionada = cargasDef[Math.floor(Math.random() * cargasDef.length)];
    
    const nuevaCarga = {
      id: Math.floor(Math.random() * 1000) + 10,
      descripcion: cargaSeleccionada.desc,
      peso: `${Math.floor(Math.random() * 5000) + 500}kg`,
      fecha: new Date(Date.now() + Math.floor(Math.random() * 15) * 86400000).toLocaleDateString(),
      icon: cargaSeleccionada.icon
    };
    
    return nuevaCarga;
  }

  // Función para mostrar cargas disponibles
  function mostrarCargasDisponibles() {
    const container = document.getElementById('cargas-disponibles');
    container.innerHTML = ''; // Limpiar contenido anterior
    
    // Detectar si estamos en modo oscuro
    const isDarkMode = document.documentElement.classList.contains('dark');
    
    cargasDisponibles.forEach(carga => {
      const cargaElement = document.createElement('div');
      cargaElement.className = 'carga-item';
      if (isDarkMode) {
        cargaElement.classList.add('dark-mode');
      }
      cargaElement.id = `carga-${carga.id}`;
      
      cargaElement.innerHTML = `
        <div class="carga-header">
          <i class="fas fa-${carga.icon}"></i> ${carga.descripcion}
        </div>
        <div class="carga-details">
          <div class="carga-detail">
            <i class="fas fa-weight-hanging"></i> ${carga.peso}
          </div>
          <div class="carga-detail">
            <i class="far fa-calendar-alt"></i> ${carga.fecha}
          </div>
        </div>
        <div class="carga-acciones">
          <button class="btn btn-aceptar" onclick="aceptarCarga(${carga.id})">
            <i class="fas fa-check"></i> Aceptar
          </button>
          <button class="btn btn-rechazar" onclick="rechazarCarga(${carga.id})">
            <i class="fas fa-times"></i> Rechazar
          </button>
        </div>
      `;
      
      container.appendChild(cargaElement);
    });
  }

  // Función para mostrar servicios aceptados
  function mostrarServiciosAceptados() {
    const container = document.getElementById('lista-servicios-aceptados');
    container.innerHTML = ''; // Limpiar contenido anterior
    
    // Detectar si estamos en modo oscuro
    const isDarkMode = document.documentElement.classList.contains('dark');
    
    // Ordenar los servicios por fecha de aceptación (más recientes primero)
    serviciosAceptados.sort((a, b) => b.fechaAceptacion - a.fechaAceptacion);
    
    serviciosAceptados.forEach(servicio => {
      const servicioElement = document.createElement('div');
      servicioElement.className = 'servicio-aceptado-item';
      if (isDarkMode) {
        servicioElement.classList.add('dark-mode');
      }
      
      // Formatear la fecha de aceptación
      const fechaAceptacion = servicio.fechaAceptacion.toLocaleDateString() + ' ' + 
                             servicio.fechaAceptacion.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      
      servicioElement.innerHTML = `
        <div class="servicio-aceptado-info">
          <div class="servicio-aceptado-header">
            <i class="fas fa-${servicio.icon}"></i> ${servicio.descripcion}
          </div>
          <div class="servicio-aceptado-details">
            <div class="servicio-aceptado-detail">
              <i class="fas fa-weight-hanging"></i> ${servicio.peso}
            </div>
            <div class="servicio-aceptado-detail">
              <i class="far fa-calendar-alt"></i> ${servicio.fecha}
            </div>
          </div>
        </div>
        <div class="servicio-aceptado-fecha">
          <i class="fas fa-clock mr-1"></i> ${fechaAceptacion}
        </div>
        <button class="btn btn-confirmar" onclick="confirmarServicio(${servicio.id})">
          <i class="fas fa-clipboard-check"></i> Confirmar
        </button>
      `;
      
      container.appendChild(servicioElement);
    });
    
    // Actualizar la visibilidad del contenedor principal
    actualizarVisibilidadContenedorServicios();
  }

  // Función para mostrar servicios confirmados
  function mostrarServiciosConfirmados() {
    const container = document.getElementById('lista-servicios-confirmados');
    container.innerHTML = ''; // Limpiar contenido anterior
    
    // Detectar si estamos en modo oscuro
    const isDarkMode = document.documentElement.classList.contains('dark');
    
    // Ordenar los servicios por fecha de confirmación (más recientes primero)
    serviciosConfirmados.sort((a, b) => b.fechaConfirmacion - a.fechaConfirmacion);
    
    serviciosConfirmados.forEach(servicio => {
      const servicioElement = document.createElement('div');
      servicioElement.className = 'servicio-aceptado-item';
      if (isDarkMode) {
        servicioElement.classList.add('dark-mode');
      }
      
      // Formatear la fecha de confirmación
      const fechaConfirmacion = servicio.fechaConfirmacion.toLocaleDateString() + ' ' + 
                              servicio.fechaConfirmacion.toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'});
      
      servicioElement.innerHTML = `
        <div class="servicio-aceptado-info">
          <div class="servicio-aceptado-header">
            <i class="fas fa-${servicio.icon}"></i> ${servicio.descripcion}
          </div>
          <div class="servicio-aceptado-details">
            <div class="servicio-aceptado-detail">
              <i class="fas fa-weight-hanging"></i> ${servicio.peso}
            </div>
            <div class="servicio-aceptado-detail">
              <i class="far fa-calendar-alt"></i> ${servicio.fecha}
            </div>
          </div>
        </div>
        <div class="servicio-aceptado-fecha">
          <i class="fas fa-clock mr-1"></i> ${fechaConfirmacion}
        </div>
      `;
      
      container.appendChild(servicioElement);
    });
    
    // Actualizar la visibilidad del contenedor principal
    actualizarVisibilidadContenedorServicios();
  }

  // Función para actualizar la visibilidad del contenedor principal de servicios
  function actualizarVisibilidadContenedorServicios() {
    const contenedorPrincipal = document.getElementById('servicios-container');
    
    // Mostrar el contenedor principal si hay servicios aceptados o confirmados
    if (serviciosAceptados.length > 0 || serviciosConfirmados.length > 0) {
      contenedorPrincipal.style.display = 'block';
    } else {
      contenedorPrincipal.style.display = 'none';
    }
  }

  // Función para aceptar una carga
  function aceptarCarga(id) {
    const cargaElement = document.getElementById(`carga-${id}`);
    const index = cargasDisponibles.findIndex(carga => carga.id === id);
    
    if (index !== -1) {
      // Quitar botones
      const accionesDiv = cargaElement.querySelector('.carga-acciones');
      accionesDiv.innerHTML = '';
      
      // Mostrar confirmación
      const confirmacion = document.createElement('div');
      confirmacion.className = 'mensaje-confirmacion confirmacion-aceptar';
      confirmacion.innerHTML = '<i class="fas fa-check-circle"></i> Carga aceptada';
      cargaElement.appendChild(confirmacion);
      
      // Agregar la carga a servicios aceptados (con fecha de aceptación)
      const cargaAceptada = {...cargasDisponibles[index], fechaAceptacion: new Date()};
      serviciosAceptados.push(cargaAceptada);
      
      // Actualizar la lista de servicios aceptados
      mostrarServiciosAceptados();
      
      // Eliminar la carga de la lista después de un tiempo
      setTimeout(() => {
        cargaElement.style.opacity = '0';
        cargaElement.style.transition = 'opacity 0.5s';
        
        setTimeout(() => {
          cargaElement.remove();
          cargasDisponibles.splice(index, 1);
          
          // Añadir una nueva carga aleatoria
          const nuevaCarga = generarNuevaCarga();
          cargasDisponibles.push(nuevaCarga);
          mostrarCargasDisponibles();
        }, 500);
      }, 2000);
    }
  }

  // Función para rechazar una carga
  function rechazarCarga(id) {
    const cargaElement = document.getElementById(`carga-${id}`);
    const index = cargasDisponibles.findIndex(carga => carga.id === id);
    
    if (index !== -1) {
      // Quitar botones
      const accionesDiv = cargaElement.querySelector('.carga-acciones');
      accionesDiv.innerHTML = '';
      
      // Mostrar confirmación
      const confirmacion = document.createElement('div');
      confirmacion.className = 'mensaje-confirmacion confirmacion-rechazar';
      confirmacion.innerHTML = '<i class="fas fa-times-circle"></i> Carga rechazada';
      cargaElement.appendChild(confirmacion);
      
      // Eliminar la carga de la lista después de un tiempo
      setTimeout(() => {
        cargaElement.style.opacity = '0';
        cargaElement.style.transition = 'opacity 0.5s';
        
        setTimeout(() => {
          cargaElement.remove();
          cargasDisponibles.splice(index, 1);
          
          // Añadir una nueva carga aleatoria
          const nuevaCarga = generarNuevaCarga();
          cargasDisponibles.push(nuevaCarga);
          mostrarCargasDisponibles();
        }, 500);
      }, 2000);
    }
  }

  // Función para confirmar un servicio
  function confirmarServicio(id) {
    const index = serviciosAceptados.findIndex(servicio => servicio.id === id);
    
    if (index !== -1) {
      // Agregar el servicio a los confirmados (con fecha de confirmación)
      const servicioConfirmado = {
        ...serviciosAceptados[index], 
        fechaConfirmacion: new Date()
      };
      serviciosConfirmados.push(servicioConfirmado);
      
      // Eliminar el servicio de la lista de aceptados
      serviciosAceptados.splice(index, 1);
      
      // Actualizar ambas listas
      mostrarServiciosAceptados();
      mostrarServiciosConfirmados();
    }
  }

  // Inicializar la visualización de cargas disponibles
  document.addEventListener('DOMContentLoaded', () => {
    mostrarCargasDisponibles();
    mostrarServiciosAceptados();
    mostrarServiciosConfirmados();
    
    // Simular la llegada de nuevas cargas disponibles cada cierto tiempo
    setInterval(() => {
      const randomIndex = Math.floor(Math.random() * cargasDisponibles.length);
      cargasDisponibles[randomIndex] = generarNuevaCarga();
      mostrarCargasDisponibles();
    }, 15000); // Cada 15 segundos
  });
</script>
{% endblock %} 