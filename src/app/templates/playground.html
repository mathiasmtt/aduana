{% extends 'base.html' %}

{% block title %}Playground de Operadores Logísticos{% endblock %}

{% block extra_head %}
<style>
  /* Estilos generales */
  h1 {
    text-align: center;
    font-size: 2.2em;
    margin-bottom: 30px;
    color: #2c3e50;
  }
  .container {
    display: flex;
    flex-direction: column;
    gap: 25px;
    width: 100%;
    max-width: 1200px;
    margin: 0 auto;
  }
  .row {
    display: flex;
    flex-wrap: wrap;
    gap: 20px;
    justify-content: center;
  }
  /* Estilos para cada tarjeta (card) */
  .card {
    background: #fff;
    border-radius: 8px;
    box-shadow: 0 5px 15px rgba(0,0,0,0.08);
    padding: 16px;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .card:hover {
    transform: translateY(-3px);
    box-shadow: 0 8px 20px rgba(0,0,0,0.12);
  }
  .card-vertical {
    flex: 1;
    min-width: 250px;
    max-width: 300px;
  }
  .card-horizontal {
    width: 100%;
  }
  .card h2 {
    font-size: 1.3em;
    margin-top: 0;
    margin-bottom: 15px;
    text-align: center;
    color: #2c3e50;
    padding-bottom: 10px;
    border-bottom: 1px solid #eaeaea;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .card h2 i {
    margin-right: 8px;
    color: #3498db;
  }
  .log {
    list-style: none;
    padding: 0;
    max-height: 300px;
    overflow-y: auto;
    margin-top: 10px;
    border-radius: 4px;
    background-color: #f9f9f9;
  }
  .log li {
    padding: 10px 12px;
    border-bottom: 1px solid #eee;
    font-size: 0.9em;
    position: relative;
    transition: background-color 0.2s;
  }
  .log li:hover {
    background-color: #f0f0f0;
  }
  .log li:last-child {
    border-bottom: none;
  }
  .timestamp {
    font-weight: bold;
    color: #7f8c8d;
    margin-right: 6px;
  }
  /* Estilos para la sección de contratación */
  .carga-item {
    padding: 15px;
    margin: 8px 0;
    border: 1px solid #eee;
    border-radius: 8px;
    display: flex;
    flex-direction: column;
    background-color: #fff;
    transition: transform 0.2s, box-shadow 0.2s;
  }
  .carga-item:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 8px rgba(0,0,0,0.1);
  }
  .carga-header {
    font-weight: bold;
    font-size: 1.1em;
    margin-bottom: 10px;
    color: #2c3e50;
    display: flex;
    align-items: center;
  }
  .carga-header i {
    margin-right: 8px;
    color: #3498db;
  }
  .carga-details {
    display: flex;
    margin: 8px 0 15px;
    color: #555;
    font-size: 0.9em;
  }
  .carga-detail {
    display: flex;
    align-items: center;
    margin-right: 18px;
  }
  .carga-detail i {
    margin-right: 5px;
    color: #7f8c8d;
  }
  .carga-acciones {
    display: flex;
    gap: 10px;
    margin-top: 5px;
    align-self: flex-end;
  }
  .btn {
    padding: 8px 16px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-size: 0.9em;
    display: flex;
    align-items: center;
    transition: transform 0.1s, opacity 0.1s;
  }
  .btn i {
    margin-right: 5px;
  }
  .btn:hover {
    transform: translateY(-2px);
  }
  .btn:active {
    transform: translateY(1px);
  }
  .btn-aceptar {
    background-color: #2ecc71;
    color: white;
  }
  .btn-aceptar:hover {
    background-color: #27ae60;
  }
  .btn-rechazar {
    background-color: #e74c3c;
    color: white;
  }
  .btn-rechazar:hover {
    background-color: #c0392b;
  }
  .mensaje-confirmacion {
    margin-top: 10px;
    padding: 8px;
    border-radius: 4px;
    font-size: 0.9em;
    text-align: center;
    display: flex;
    align-items: center;
    justify-content: center;
  }
  .confirmacion-aceptar {
    background-color: #e8f5e9;
    color: #2e7d32;
  }
  .confirmacion-rechazar {
    background-color: #ffebee;
    color: #c62828;
  }
  /* Estilo específico para grid de cargas */
  .cargas-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: 15px;
    margin-top: 15px;
  }
</style>
{% endblock %}

{% block content %}
<h1 class="mt-8">Playground en Tiempo Real</h1>
<div class="container pb-10">
  <div class="row">
    <div class="card card-vertical dark:bg-gray-800 dark:text-white" id="importadores">
      <h2><i class="fas fa-ship"></i> Importadores</h2>
      <ul class="log dark:bg-gray-700 dark:text-gray-200" id="log-importadores"></ul>
    </div>
    <div class="card card-vertical dark:bg-gray-800 dark:text-white" id="seguros">
      <h2><i class="fas fa-shield-alt"></i> Seguros</h2>
      <ul class="log dark:bg-gray-700 dark:text-gray-200" id="log-seguros"></ul>
    </div>
    <div class="card card-vertical dark:bg-gray-800 dark:text-white" id="transportistas">
      <h2><i class="fas fa-truck"></i> Transportistas</h2>
      <ul class="log dark:bg-gray-700 dark:text-gray-200" id="log-transportistas"></ul>
    </div>
    <div class="card card-vertical dark:bg-gray-800 dark:text-white" id="despachantes">
      <h2><i class="fas fa-clipboard-check"></i> Despachantes de Aduana</h2>
      <ul class="log dark:bg-gray-700 dark:text-gray-200" id="log-despachantes"></ul>
    </div>
  </div>
  
  <div class="card card-horizontal dark:bg-gray-800 dark:text-white" id="contratacion">
    <h2><i class="fas fa-handshake"></i> Contratación de Servicios</h2>
    <div id="cargas-disponibles" class="cargas-grid">
      <!-- Las cargas disponibles se cargarán aquí dinámicamente -->
    </div>
  </div>
</div>

<script>
  // Datos de cada rol con mensajes de ejemplo
  const roles = [
    {
      id: 'importadores',
      log: 'log-importadores',
      mensajes: ['Pedido recibido', 'Documentación enviada', 'Aprobación de importación'],
      icon: 'ship'
    },
    {
      id: 'seguros',
      log: 'log-seguros',
      mensajes: ['Póliza emitida', 'Revisión de cobertura', 'Pago confirmado'],
      icon: 'shield-alt'
    },
    {
      id: 'transportistas',
      log: 'log-transportistas',
      mensajes: ['Vehículo asignado', 'Salida en ruta', 'Llegada estimada'],
      icon: 'truck'
    },
    {
      id: 'despachantes',
      log: 'log-despachantes',
      mensajes: ['Despacho en proceso', 'Documentos verificados', 'Despacho completado'],
      icon: 'clipboard-check'
    }
  ];

  // Función para agregar un mensaje a la lista correspondiente
  function agregarMensaje(roleObj) {
    const logUl = document.getElementById(roleObj.log);
    const li = document.createElement('li');
    // Selecciona un mensaje aleatorio del arreglo
    const msg = roleObj.mensajes[Math.floor(Math.random() * roleObj.mensajes.length)];
    // Se agrega una marca de tiempo para simular un log en tiempo real
    const timestamp = new Date().toLocaleTimeString();
    li.innerHTML = `<span class="timestamp">[${timestamp}]</span> <i class="fas fa-${roleObj.icon}"></i> ${msg}`;
    logUl.appendChild(li);
    // Se asegura de que la vista haga scroll hacia el final para ver el mensaje nuevo
    logUl.scrollTop = logUl.scrollHeight;
  }

  // Simula la llegada de mensajes en intervalos aleatorios (entre 2 y 5 segundos)
  roles.forEach(role => {
    setInterval(() => {
      agregarMensaje(role);
    }, Math.random() * 3000 + 2000);
  });

  // Datos de cargas disponibles (simulados)
  const cargasDisponibles = [
    { 
      id: 1, 
      descripcion: 'Contenedor de electrónicos desde China', 
      peso: '2500kg', 
      fecha: '15/06/2023',
      icon: 'microchip'
    },
    { 
      id: 2, 
      descripcion: 'Carga de alimentos refrigerados', 
      peso: '1800kg', 
      fecha: '18/06/2023',
      icon: 'temperature-low' 
    },
    { 
      id: 3, 
      descripcion: 'Materiales de construcción', 
      peso: '4200kg', 
      fecha: '20/06/2023',
      icon: 'hard-hat'
    },
    { 
      id: 4, 
      descripcion: 'Productos farmacéuticos', 
      peso: '950kg', 
      fecha: '22/06/2023',
      icon: 'pills'
    },
    { 
      id: 5, 
      descripcion: 'Equipamiento industrial', 
      peso: '3100kg', 
      fecha: '25/06/2023',
      icon: 'industry'
    }
  ];

  // Mapa de iconos para diferentes tipos de cargas
  const iconMap = {
    'textiles': 'tshirt',
    'médicos': 'heartbeat',
    'automotrices': 'car',
    'químicos': 'flask',
    'oficina': 'chair',
    'electrónicos': 'laptop'
  };

  // Función para generar una nueva carga disponible de forma aleatoria
  function generarNuevaCarga() {
    const cargasDef = [
      { desc: 'Contenedor de productos textiles', icon: 'tshirt' }, 
      { desc: 'Equipos médicos urgentes', icon: 'heartbeat' }, 
      { desc: 'Materiales automotrices', icon: 'car' }, 
      { desc: 'Productos químicos industriales', icon: 'flask' },
      { desc: 'Mobiliario de oficina', icon: 'chair' },
      { desc: 'Equipos electrónicos sensibles', icon: 'laptop' }
    ];
    
    const cargaSeleccionada = cargasDef[Math.floor(Math.random() * cargasDef.length)];
    
    const nuevaCarga = {
      id: Math.floor(Math.random() * 1000) + 10,
      descripcion: cargaSeleccionada.desc,
      peso: `${Math.floor(Math.random() * 5000) + 500}kg`,
      fecha: new Date(Date.now() + Math.floor(Math.random() * 15) * 86400000).toLocaleDateString(),
      icon: cargaSeleccionada.icon
    };
    
    return nuevaCarga;
  }

  // Función para mostrar cargas disponibles
  function mostrarCargasDisponibles() {
    const container = document.getElementById('cargas-disponibles');
    container.innerHTML = ''; // Limpiar contenido anterior
    
    cargasDisponibles.forEach(carga => {
      const cargaElement = document.createElement('div');
      cargaElement.className = 'carga-item dark:bg-gray-700 dark:text-gray-200';
      cargaElement.id = `carga-${carga.id}`;
      
      cargaElement.innerHTML = `
        <div class="carga-header">
          <i class="fas fa-${carga.icon}"></i> ${carga.descripcion}
        </div>
        <div class="carga-details">
          <div class="carga-detail">
            <i class="fas fa-weight-hanging"></i> ${carga.peso}
          </div>
          <div class="carga-detail">
            <i class="far fa-calendar-alt"></i> ${carga.fecha}
          </div>
        </div>
        <div class="carga-acciones">
          <button class="btn btn-aceptar" onclick="aceptarCarga(${carga.id})">
            <i class="fas fa-check"></i> Aceptar
          </button>
          <button class="btn btn-rechazar" onclick="rechazarCarga(${carga.id})">
            <i class="fas fa-times"></i> Rechazar
          </button>
        </div>
      `;
      
      container.appendChild(cargaElement);
    });
  }

  // Función para aceptar una carga
  function aceptarCarga(id) {
    const cargaElement = document.getElementById(`carga-${id}`);
    const index = cargasDisponibles.findIndex(carga => carga.id === id);
    
    if (index !== -1) {
      // Quitar botones
      const accionesDiv = cargaElement.querySelector('.carga-acciones');
      accionesDiv.innerHTML = '';
      
      // Mostrar confirmación
      const confirmacion = document.createElement('div');
      confirmacion.className = 'mensaje-confirmacion confirmacion-aceptar';
      confirmacion.innerHTML = '<i class="fas fa-check-circle"></i> Carga aceptada';
      cargaElement.appendChild(confirmacion);
      
      // Eliminar la carga de la lista después de un tiempo
      setTimeout(() => {
        cargaElement.style.opacity = '0';
        cargaElement.style.transition = 'opacity 0.5s';
        
        setTimeout(() => {
          cargaElement.remove();
          cargasDisponibles.splice(index, 1);
          
          // Añadir una nueva carga aleatoria
          const nuevaCarga = generarNuevaCarga();
          cargasDisponibles.push(nuevaCarga);
          mostrarCargasDisponibles();
        }, 500);
      }, 2000);
    }
  }

  // Función para rechazar una carga
  function rechazarCarga(id) {
    const cargaElement = document.getElementById(`carga-${id}`);
    const index = cargasDisponibles.findIndex(carga => carga.id === id);
    
    if (index !== -1) {
      // Quitar botones
      const accionesDiv = cargaElement.querySelector('.carga-acciones');
      accionesDiv.innerHTML = '';
      
      // Mostrar confirmación
      const confirmacion = document.createElement('div');
      confirmacion.className = 'mensaje-confirmacion confirmacion-rechazar';
      confirmacion.innerHTML = '<i class="fas fa-times-circle"></i> Carga rechazada';
      cargaElement.appendChild(confirmacion);
      
      // Eliminar la carga de la lista después de un tiempo
      setTimeout(() => {
        cargaElement.style.opacity = '0';
        cargaElement.style.transition = 'opacity 0.5s';
        
        setTimeout(() => {
          cargaElement.remove();
          cargasDisponibles.splice(index, 1);
          
          // Añadir una nueva carga aleatoria
          const nuevaCarga = generarNuevaCarga();
          cargasDisponibles.push(nuevaCarga);
          mostrarCargasDisponibles();
        }, 500);
      }, 2000);
    }
  }

  // Inicializar la visualización de cargas disponibles
  document.addEventListener('DOMContentLoaded', () => {
    mostrarCargasDisponibles();
    
    // Simular la llegada de nuevas cargas disponibles cada cierto tiempo
    setInterval(() => {
      const randomIndex = Math.floor(Math.random() * cargasDisponibles.length);
      cargasDisponibles[randomIndex] = generarNuevaCarga();
      mostrarCargasDisponibles();
    }, 15000); // Cada 15 segundos
  });
</script>
{% endblock %} 